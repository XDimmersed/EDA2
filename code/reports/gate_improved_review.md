# `gate_improved.cpp` 代码问题检查

## 半格裁剪交点计算错误
- 在 `sutherland_hodgman_clip` 的半格路径中，奇数 `coord2` 时直接返回边的中点（L107-L120）。
- 实际应在 `2×` 坐标系下计算与切线的精确交点，否则交点落在错误位置，导致片段轮廓偏离真实切线。

## 切片导通图构建存在越界/错连
- 竖切和横切过程中，拆分出的两个新片段通过 `left_idx/right_idx` 或 `lower_idx/upper_idx` 建立导通，但随后直接把父片段的 `neighbor` 索引当作新索引使用（L351-L364, L403-L416）。
- 这些 `neighbor` 基于旧的片段序号，通常还未插入 `new_pieces`；`new_adjacency[neighbor]` 会出现越界或把导通关系写到错误的节点上。
- 未被切割的片段也直接拷贝原邻接列表（L369-L375, L421-L427），同样保留了失效的旧索引。

## 贯穿判据过于依赖包围盒比例
- `is_full_penetration` 只用交集 bbox 面积阈值和 AA 边界是否覆盖来判定（L32-L67）。
- 这种仅靠 bbox 的判据会把“边角擦碰”误判为贯穿，或漏掉实际与 AA 两侧都有交点但交集面积不到 80% 的细长导通结构。
